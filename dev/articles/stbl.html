<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Getting started with stbl • stbl</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Getting started with stbl">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">stbl</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.2.0.9004</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/stbl.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/api2r/stbl/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Getting started with stbl</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/api2r/stbl/blob/main/vignettes/stbl.Rmd" class="external-link"><code>vignettes/stbl.Rmd</code></a></small>
      <div class="d-none name"><code>stbl.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stbl.api2r.org/">stbl</a></span><span class="op">)</span></span></code></pre></div>
<p>The goal of {stbl} is to help you stabilize function arguments
<em>before</em> you use them. This is especially important when a
function performs a slow or expensive operation, like writing to a
database or calling a web API. You want to fail fast and with a clear
error message if the inputs aren’t right.</p>
<p>This vignette demonstrates this principle by incrementally building a
single function, <code>register_user()</code>, which validates several
arguments before hypothetically sending them to an external service.</p>
<div class="section level2">
<h2 id="the-register_user-function">The <code>register_user()</code> Function<a class="anchor" aria-label="anchor" href="#the-register_user-function"></a>
</h2>
<p>Here is the base function we’ll be improving. Without any checks,
it’s vulnerable to bad inputs that could cause cryptic errors later on
or send corrupt data to our external service.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">register_user</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">username</span>,</span>
<span>                          <span class="va">email_address</span>,</span>
<span>                          <span class="va">age</span>,</span>
<span>                          <span class="va">is_premium_member</span>,</span>
<span>                          <span class="va">interests</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Imagine this is a slow API call, rather than simply returning the list()</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    username <span class="op">=</span> <span class="va">username</span>,</span>
<span>    email_address <span class="op">=</span> <span class="va">email_address</span>,</span>
<span>    age <span class="op">=</span> <span class="va">age</span>,</span>
<span>    is_premium_member <span class="op">=</span> <span class="va">is_premium_member</span>,</span>
<span>    interests <span class="op">=</span> <span class="va">interests</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="step-1-handling-a-vector-with-to_">Step 1: Handling a Vector with <code>to_*()</code><a class="anchor" aria-label="anchor" href="#step-1-handling-a-vector-with-to_"></a>
</h2>
<p>Let’s start adding checks. The first check will be for the
<code>interests</code> argument. We expect this to be a character
vector, but we’re not picky about the content. <code><a href="../reference/stabilize_chr.html">to_chr()</a></code>
will convert inputs that are character-like (like factors or a simple
list of strings) into a proper character vector.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">register_user</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">username</span>,</span>
<span>                          <span class="va">email_address</span>,</span>
<span>                          <span class="va">age</span>,</span>
<span>                          <span class="va">is_premium_member</span>,</span>
<span>                          <span class="va">interests</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">interests</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stabilize_chr.html">to_chr</a></span><span class="op">(</span><span class="va">interests</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    username <span class="op">=</span> <span class="va">username</span>,</span>
<span>    email_address <span class="op">=</span> <span class="va">email_address</span>,</span>
<span>    age <span class="op">=</span> <span class="va">age</span>,</span>
<span>    is_premium_member <span class="op">=</span> <span class="va">is_premium_member</span>,</span>
<span>    interests <span class="op">=</span> <span class="va">interests</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The function still returns the list when <code>interests</code> is a
character vector:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">register_user</span><span class="op">(</span></span>
<span>  username <span class="op">=</span> <span class="st">"test_user"</span>, </span>
<span>  email_address <span class="op">=</span> <span class="st">"test@example.com"</span>, </span>
<span>  age <span class="op">=</span> <span class="fl">42</span>, </span>
<span>  is_premium_member <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>  interests <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"R"</span>, <span class="st">"hiking"</span><span class="op">)</span>    <span class="co"># Note that this is already a character vector</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># Note: Throughout this article, we pipe the result into `str()` to make it</span></span>
<span>  <span class="co"># easier to see the differences.</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 5</span></span>
<span><span class="co">#&gt;  $ username         : chr "test_user"</span></span>
<span><span class="co">#&gt;  $ email_address    : chr "test@example.com"</span></span>
<span><span class="co">#&gt;  $ age              : num 42</span></span>
<span><span class="co">#&gt;  $ is_premium_member: logi TRUE</span></span>
<span><span class="co">#&gt;  $ interests        : chr [1:2] "R" "hiking"</span></span></code></pre></div>
<p>It also works when <code>interests</code> is a list of strings:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">register_user</span><span class="op">(</span></span>
<span>  username <span class="op">=</span> <span class="st">"test_user"</span>, </span>
<span>  email_address <span class="op">=</span> <span class="st">"test@example.com"</span>, </span>
<span>  age <span class="op">=</span> <span class="fl">42</span>, </span>
<span>  is_premium_member <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>  interests <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"R"</span>, <span class="st">"hiking"</span><span class="op">)</span> <span class="co"># This is a list, but becomes a character vector</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 5</span></span>
<span><span class="co">#&gt;  $ username         : chr "test_user"</span></span>
<span><span class="co">#&gt;  $ email_address    : chr "test@example.com"</span></span>
<span><span class="co">#&gt;  $ age              : num 42</span></span>
<span><span class="co">#&gt;  $ is_premium_member: logi TRUE</span></span>
<span><span class="co">#&gt;  $ interests        : chr [1:2] "R" "hiking"</span></span></code></pre></div>
<p>If the input is something that cannot be reasonably flattened to a
character vector, it fails with a helpful error message:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fails because the list contains a function, which is not character-like.</span></span>
<span><span class="fu">register_user</span><span class="op">(</span></span>
<span>  username <span class="op">=</span> <span class="st">"test_user"</span>, </span>
<span>  email_address <span class="op">=</span> <span class="st">"test@example.com"</span>, </span>
<span>  age <span class="op">=</span> <span class="fl">42</span>, </span>
<span>  is_premium_member <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>  interests <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"R"</span>, <span class="va">mean</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `register_user()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Can't coerce `interests` <span style="color: #0000BB;">&lt;list&gt;</span> to <span style="color: #0000BB;">&lt;character&gt;</span>.</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="step-2-simple-scalar-coercion-with-to__scalar">Step 2: Simple Scalar Coercion with <code>to_*_scalar()</code><a class="anchor" aria-label="anchor" href="#step-2-simple-scalar-coercion-with-to__scalar"></a>
</h2>
<p>Next, we’ll add checks for <code>age</code> and
<code>is_premium_member</code>. These arguments must each contain a
single value. We’ll use the <code>_scalar</code> variants:
<code><a href="../reference/stabilize_int.html">to_int_scalar()</a></code> and <code><a href="../reference/stabilize_lgl.html">to_lgl_scalar()</a></code>. These
functions are liberal in what they accept. For example,
<code><a href="../reference/stabilize_lgl.html">to_lgl_scalar()</a></code> understands that <code>1</code>,
<code>"T"</code>, and <code>"True"</code> all mean
<code>TRUE</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">register_user</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">username</span>,</span>
<span>                          <span class="va">email_address</span>,</span>
<span>                          <span class="va">age</span>,</span>
<span>                          <span class="va">is_premium_member</span>,</span>
<span>                          <span class="va">interests</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">interests</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stabilize_chr.html">to_chr</a></span><span class="op">(</span><span class="va">interests</span><span class="op">)</span></span>
<span>  <span class="va">age</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stabilize_int.html">to_int_scalar</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span></span>
<span>  <span class="va">is_premium_member</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stabilize_lgl.html">to_lgl_scalar</a></span><span class="op">(</span><span class="va">is_premium_member</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    username <span class="op">=</span> <span class="va">username</span>,</span>
<span>    email_address <span class="op">=</span> <span class="va">email_address</span>,</span>
<span>    age <span class="op">=</span> <span class="va">age</span>,</span>
<span>    is_premium_member <span class="op">=</span> <span class="va">is_premium_member</span>,</span>
<span>    interests <span class="op">=</span> <span class="va">interests</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>When everything follows the rules, <code>register_user()</code>
works:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">register_user</span><span class="op">(</span></span>
<span>  username <span class="op">=</span> <span class="st">"test_user"</span>, </span>
<span>  email_address <span class="op">=</span> <span class="st">"test@example.com"</span>, </span>
<span>  age <span class="op">=</span> <span class="st">"42"</span>,                 <span class="co"># Coercible to integer</span></span>
<span>  is_premium_member <span class="op">=</span> <span class="st">"True"</span>, <span class="co"># Coercible to logical</span></span>
<span>  interests <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"R"</span>, <span class="st">"hiking"</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 5</span></span>
<span><span class="co">#&gt;  $ username         : chr "test_user"</span></span>
<span><span class="co">#&gt;  $ email_address    : chr "test@example.com"</span></span>
<span><span class="co">#&gt;  $ age              : int 42</span></span>
<span><span class="co">#&gt;  $ is_premium_member: logi TRUE</span></span>
<span><span class="co">#&gt;  $ interests        : chr [1:2] "R" "hiking"</span></span></code></pre></div>
<p>The <code>register_user()</code> function will fail with clear error
messages if the input isn’t a single value or can’t be coerced.</p>
<p>For example, when age is not a single value,
<code>register_user()</code> throws an error:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">register_user</span><span class="op">(</span></span>
<span>  username <span class="op">=</span> <span class="st">"test_user"</span>, </span>
<span>  email_address <span class="op">=</span> <span class="st">"test@example.com"</span>, </span>
<span>  age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">31</span><span class="op">)</span>,            <span class="co"># Not a single value</span></span>
<span>  is_premium_member <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>  interests <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"R"</span>, <span class="st">"hiking"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `register_user()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> `age` must be a single <span style="color: #0000BB;">&lt;integer&gt;</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> `age` has 2 values.</span></span></code></pre></div>
<p>Likewise, this next example fails because “forty-two” cannot be
converted to an integer:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">register_user</span><span class="op">(</span></span>
<span>  username <span class="op">=</span> <span class="st">"test_user"</span>, </span>
<span>  email_address <span class="op">=</span> <span class="st">"test@example.com"</span>, </span>
<span>  age <span class="op">=</span> <span class="st">"forty-two"</span>,          <span class="co"># Not coercible to integer</span></span>
<span>  is_premium_member <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>  interests <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"R"</span>, <span class="st">"hiking"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `register_user()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> `age` <span style="color: #0000BB;">&lt;character&gt;</span> must be coercible to <span style="color: #0000BB;">&lt;integer&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> Can't convert some values due to incompatible values.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> Locations: 1</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="step-3-complex-validation-with-stabilize_">Step 3: Complex Validation with <code>stabilize_*()</code><a class="anchor" aria-label="anchor" href="#step-3-complex-validation-with-stabilize_"></a>
</h2>
<p>Finally, let’s add more complex validation for <code>username</code>
and <code>email_address</code>. For these, simple type coercion isn’t
enough; we need to check their content and structure using
<code><a href="../reference/stabilize_chr.html">stabilize_chr_scalar()</a></code>. This function first coerces the
input to character, then applies a list of validation rules supplied via
the <code>regex</code> argument (see the <code><a href="../reference/stabilize_chr.html">stabilize_chr()</a></code>
documentation for details). If speed matters, you should prefer the
faster <code>to_*()</code> functions and only “upgrade” to
<code>stabilize_*()</code> when you need these additional checks.</p>
<p>This is our final, fully stabilized function:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">register_user</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">username</span>,</span>
<span>                          <span class="va">email_address</span>,</span>
<span>                          <span class="va">age</span>,</span>
<span>                          <span class="va">is_premium_member</span>,</span>
<span>                          <span class="va">interests</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Simple checks.</span></span>
<span>  <span class="va">interests</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stabilize_chr.html">to_chr</a></span><span class="op">(</span><span class="va">interests</span><span class="op">)</span></span>
<span>  <span class="va">age</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stabilize_int.html">to_int_scalar</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span></span>
<span>  <span class="va">is_premium_member</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stabilize_lgl.html">to_lgl_scalar</a></span><span class="op">(</span><span class="va">is_premium_member</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Make sure the username is a length-1 character vector without any spaces,</span></span>
<span>  <span class="co"># tabs, or newlines. "\\s" means "any space character".</span></span>
<span>  <span class="va">space_regex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"must not contain spaces"</span> <span class="op">=</span> <span class="st">"\\s"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">space_regex</span>, <span class="st">"negate"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span>  <span class="va">username</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stabilize_chr.html">stabilize_chr_scalar</a></span><span class="op">(</span></span>
<span>    <span class="va">username</span>,</span>
<span>    regex <span class="op">=</span> <span class="va">space_regex</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># The email address has to have the pattern "*@*.*". Or, in regex, "^" (start</span></span>
<span>  <span class="co"># of string), "[...]+" (one or more of any character in the brackets), "@"</span></span>
<span>  <span class="co"># (the at sign), "[...]+" (one or more of any character in the brackets),</span></span>
<span>  <span class="co"># "\\." (a literal period), "[...]{2,}" (two or more of any character in the</span></span>
<span>  <span class="co"># brackets), "$" (end of string).</span></span>
<span>  <span class="va">email_regex</span> <span class="op">&lt;-</span> <span class="st">"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$"</span></span>
<span>  <span class="va">email_address</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stabilize_chr.html">stabilize_chr_scalar</a></span><span class="op">(</span></span>
<span>    <span class="va">email_address</span>,</span>
<span>    regex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"must be a valid email address"</span> <span class="op">=</span> <span class="va">email_regex</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    username <span class="op">=</span> <span class="va">username</span>,</span>
<span>    email_address <span class="op">=</span> <span class="va">email_address</span>,</span>
<span>    age <span class="op">=</span> <span class="va">age</span>,</span>
<span>    is_premium_member <span class="op">=</span> <span class="va">is_premium_member</span>,</span>
<span>    interests <span class="op">=</span> <span class="va">interests</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>When all of the inputs follow the expectations, the call
succeeds:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">register_user</span><span class="op">(</span></span>
<span>  username <span class="op">=</span> <span class="st">"test_user"</span>, </span>
<span>  email_address <span class="op">=</span> <span class="st">"test@example.com"</span>, </span>
<span>  age <span class="op">=</span> <span class="fl">42</span>, </span>
<span>  is_premium_member <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>  interests <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"R"</span>, <span class="st">"hiking"</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 5</span></span>
<span><span class="co">#&gt;  $ username         : chr "test_user"</span></span>
<span><span class="co">#&gt;  $ email_address    : chr "test@example.com"</span></span>
<span><span class="co">#&gt;  $ age              : int 42</span></span>
<span><span class="co">#&gt;  $ is_premium_member: logi TRUE</span></span>
<span><span class="co">#&gt;  $ interests        : chr [1:2] "R" "hiking"</span></span></code></pre></div>
<p>If anything is wrong, it fails with informative error messages.</p>
<p>When the username has a space, <code>register_user()</code> fails
with an informative error message:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">register_user</span><span class="op">(</span></span>
<span>  username <span class="op">=</span> <span class="st">"test user"</span>, </span>
<span>  email_address <span class="op">=</span> <span class="st">"test@example.com"</span>, </span>
<span>  age <span class="op">=</span> <span class="fl">42</span>, </span>
<span>  is_premium_member <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>  interests <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"R"</span>, <span class="st">"hiking"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `register_user()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> `username` must not contain spaces</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">"test user"</span> fails the check.</span></span></code></pre></div>
<p>This example fails because the email address is invalid:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">register_user</span><span class="op">(</span></span>
<span>  username <span class="op">=</span> <span class="st">"test_user"</span>, </span>
<span>  email_address <span class="op">=</span> <span class="st">"not-a-valid-email"</span>, </span>
<span>  age <span class="op">=</span> <span class="fl">42</span>, </span>
<span>  is_premium_member <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>  interests <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"R"</span>, <span class="st">"hiking"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `register_user()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> `email_address` must be a valid email address</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">"not-a-valid-email"</span> fails the check.</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>Our <code>register_user()</code> function is now robust against a
variety of bad inputs. We’ve built up layers of protection:</p>
<ul>
<li>
<code><a href="../reference/stabilize_chr.html">to_chr()</a></code> ensures <code>interests</code> is a character
vector.</li>
<li>
<code><a href="../reference/stabilize_int.html">to_int_scalar()</a></code> and <code><a href="../reference/stabilize_lgl.html">to_lgl_scalar()</a></code> ensure
<code>age</code> and <code>is_premium_member</code> are single values of
the correct type.</li>
<li>
<code><a href="../reference/stabilize_chr.html">stabilize_chr_scalar()</a></code> with regex rules ensures
<code>username</code> and <code>email_address</code> meet specific
content requirements.</li>
</ul>
<p>If the user enters something strange, they’ll get a clear error
message <em>before</em> we do anything expensive, like calling an
external API.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jon Harmon.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
